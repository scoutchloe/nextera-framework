<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢å•çŠ¶æ€æ›´æ–°APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .recommended { border-color: #007bff; background-color: #f8f9fa; }
        button { margin: 5px; padding: 8px 15px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .debug { background: #fff3cd; color: #856404; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
    <h1>è®¢å•çŠ¶æ€æ›´æ–°APIæµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•å‚æ•°</h3>
        <label>è®¢å•ID: <input type="number" id="orderId" value="1"></label><br><br>
        <label>æ–°çŠ¶æ€: 
            <select id="newStatus">
                <option value="1">å¾…æ”¯ä»˜</option>
                <option value="2" selected>å·²æ”¯ä»˜</option>
                <option value="3">å·²å‘è´§</option>
                <option value="4">å·²å®Œæˆ</option>
                <option value="5">å·²å–æ¶ˆ</option>
            </select>
        </label><br><br>
        <label>APIåŸºç¡€URL: <input type="text" id="baseUrl" value="/api" style="width: 200px;"></label>
    </div>

    <div class="test-section recommended">
        <h3>ğŸ¯ æ¨èæ–¹å¼ï¼šæŸ¥è¯¢å‚æ•°ä¼ é€’ ?status=xxx</h3>
        <button onclick="testQueryParams()" style="background-color: #007bff; color: white;">æµ‹è¯•æŸ¥è¯¢å‚æ•°æ–¹å¼</button>
        <pre>PUT /order/{id}/status?status={newStatus}</pre>
        <div id="debugQuery" class="debug"></div>
        <div id="resultQuery" class="result"></div>
    </div>

    <div class="test-section">
        <h3>æ–¹å¼1ï¼šè¯·æ±‚ä½“ä¼ é€’å‚æ•°</h3>
        <button onclick="testMethod1()">æµ‹è¯•æ–¹å¼1</button>
        <pre>PUT /order/{id}/status
Content-Type: application/json
{
  "status": newStatus,
  "orderId": orderId
}</pre>
        <div id="result1" class="result"></div>
    </div>

    <div class="test-section">
        <h3>æ–¹å¼2ï¼šè·¯å¾„å‚æ•°ä¼ é€’</h3>
        <button onclick="testMethod3()">æµ‹è¯•æ–¹å¼2</button>
        <pre>PUT /order/{id}/status/{newStatus}</pre>
        <div id="result3" class="result"></div>
    </div>

    <div class="test-section">
        <h3>æ–¹å¼3ï¼šè¡¨å•æ•°æ®ä¼ é€’</h3>
        <button onclick="testMethod4()">æµ‹è¯•æ–¹å¼3</button>
        <pre>PUT /order/{id}/status
Content-Type: application/x-www-form-urlencoded
status={newStatus}</pre>
        <div id="result4" class="result"></div>
    </div>

    <script>
        function getValues() {
            return {
                orderId: document.getElementById('orderId').value,
                newStatus: document.getElementById('newStatus').value,
                baseUrl: document.getElementById('baseUrl').value
            };
        }

        function showResult(elementId, success, data) {
            const element = document.getElementById(elementId);
            element.className = success ? 'result success' : 'result error';
            element.innerHTML = `
                <strong>${success ? 'æˆåŠŸ' : 'å¤±è´¥'}:</strong><br>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        }

        function showDebug(elementId, info) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <strong>è°ƒè¯•ä¿¡æ¯:</strong><br>
                <pre>${info}</pre>
            `;
        }

        // æ¨èçš„æŸ¥è¯¢å‚æ•°æ–¹å¼
        async function testQueryParams() {
            const { orderId, newStatus, baseUrl } = getValues();
            const url = `${baseUrl}/order/${orderId}/status?status=${newStatus}`;
            
            showDebug('debugQuery', `è¯·æ±‚URL: ${url}\nè¯·æ±‚æ–¹æ³•: PUT\nå‚æ•°ä¼ é€’æ–¹å¼: æŸ¥è¯¢å‚æ•°`);
            
            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token') || 'test-token'}`
                    }
                });
                const data = await response.json();
                showResult('resultQuery', response.ok, { 
                    status: response.status, 
                    url: url,
                    data 
                });
            } catch (error) {
                showResult('resultQuery', false, { 
                    error: error.message,
                    url: url
                });
            }
        }

        async function testMethod1() {
            const { orderId, newStatus, baseUrl } = getValues();
            try {
                const response = await fetch(`${baseUrl}/order/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || 'test-token'}`
                    },
                    body: JSON.stringify({
                        status: parseInt(newStatus),
                        orderId: parseInt(orderId)
                    })
                });
                const data = await response.json();
                showResult('result1', response.ok, { status: response.status, data });
            } catch (error) {
                showResult('result1', false, { error: error.message });
            }
        }

        async function testMethod3() {
            const { orderId, newStatus, baseUrl } = getValues();
            try {
                const response = await fetch(`${baseUrl}/order/${orderId}/status/${newStatus}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token') || 'test-token'}`
                    }
                });
                const data = await response.json();
                showResult('result3', response.ok, { status: response.status, data });
            } catch (error) {
                showResult('result3', false, { error: error.message });
            }
        }

        async function testMethod4() {
            const { orderId, newStatus, baseUrl } = getValues();
            try {
                const formData = new URLSearchParams();
                formData.append('status', newStatus);
                formData.append('orderId', orderId);

                const response = await fetch(`${baseUrl}/order/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': `Bearer ${localStorage.getItem('token') || 'test-token'}`
                    },
                    body: formData
                });
                const data = await response.json();
                showResult('result4', response.ok, { status: response.status, data });
            } catch (error) {
                showResult('result4', false, { error: error.message });
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰tokenå’Œè°ƒè¯•ä¿¡æ¯
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                console.log('å½“å‰token:', token);
            } else {
                console.log('æœªæ‰¾åˆ°tokenï¼Œä½¿ç”¨æµ‹è¯•token');
            }
            
            // æ˜¾ç¤ºå½“å‰é…ç½®
            console.log('æµ‹è¯•é…ç½®:', getValues());
        };
    </script>
</body>
</html> 